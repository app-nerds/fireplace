/* v1.5.3 */
const fetch$1=window.fetch.bind(window),objectToMap=(e={})=>{let t=new Map;for(const o in e)t.set(o,e[o]);return t};class BaseView extends HTMLElement{constructor(e){super(),this._title="",this.params=e,this._state={},this.router=window._router}async connectedCallback(){await this.beforeRender(),await this.render(),this._setDocumentTitle(),await this.afterRender()}disconnectedCallback(){this.onUnload()}_setDocumentTitle(){var e=this.querySelectorAll("title");e&&0<e.length&&(this._title=e[0].innerText,document.title=this._title,this.removeChild(e[0]))}async beforeRender(){}async afterRender(){}async onUnload(){}async render(){throw new Error("not implemented")}get title(){return this._title}get html(){return this._html}get state(){return this._state}set state(e){this._state=e}getQueryParam(e){return this.router.getQueryParam(e)}navigateTo(e,t={},o={}){this.router.navigateTo(e,t,o)}}class DefaultPageNotFound extends BaseView{constructor(e){super(e)}async render(){return`
			<title>Page Not Found</title>
			<p>The page ${this.params.path} could not be found.</p>
		`}}customElements.define("default-page-not-found",DefaultPageNotFound);class Router{constructor(e,t,o=null){this.targetEl=e,this.routes=t,this.pageNotFoundView=o,this.beforeRoute=null,this.afterRoute=null,this.injectParams=null,this.pageNotFoundView?this.routes.push({path:"/404notfound/:path",view:this.pageNotFoundView}):this.routes.push({path:"/404notfound/:path",view:DefaultPageNotFound})}_pathToRegex(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}_getParams(e){let t=0;var o=e.result.slice(1),r=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(e=>e[1]);let n={};for(t=0;t<o.length;t++)n[r[t]]=o[t];if(this.injectParams){var a=this.injectParams(e);for(const i in a)n[i]=a[i]}return n}async _route(e){let t={};e.state&&(t=e.state);const o=this.routes.map(e=>({route:e,result:location.pathname.match(this._pathToRegex(e.path))}));let r=o.find(e=>null!==e.result);if(r){if(!this.beforeRoute||!1!==this.beforeRoute.apply(this,r.route)){e=this._getParams(r);const n=new r.route.view(e),a=(n.state=t,document.querySelector(this.targetEl));a.innerHTML="",a.appendChild(n),this.afterRoute&&this.afterRoute(r.route)}}else this.navigateTo("/404notfound"+location.pathname)}getQueryParam(e){let t=new URLSearchParams(location.search);return t.get(e)}navigateTo(e,t={},o={}){let r="";if(0<Object.keys(t).length){var n,a,t=objectToMap(t);r+="?";for([n,a]of t){var i=encodeURIComponent(n);let e=a;"object"==typeof a&&(e=JSON.stringify(a));var s=encodeURIComponent(e);r+=i+`=${s}&`}}history.pushState(o,null,""+e+r),this._route({state:o})}}class GraphQL{constructor(e="",t=fetch,o=null,r=null){this.queryURL=e,this.http=t,this.tokenGetterFunction=o,this.expiredTokenCallback=r}async query(o){if(!this.expiredTokenCallback||this.expiredTokenCallback()){var r=this.tokenGetterFunction?this.tokenGetterFunction():"";o=`query {
			${o}
		}`;let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o})},t=(r&&(e.headers.Authorization="Bearer "+r),await this.http(this.queryURL,e));if(400!==t.status&&401!==t.status){o=await t.json();if(t.ok)return o;throw new Error(o.message)}this.expiredTokenCallback&&this.expiredTokenCallback(t)}}async mutation(o){if(!this.expiredTokenCallback||this.expiredTokenCallback()){var r=this.tokenGetterFunction?this.tokenGetterFunction():"";o=`mutation {
			${o}
		}`;let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o})},t=(r&&(e.headers.Authorization="Bearer "+r),await this.http(this.queryURL,e));if(400!==t.status&&401!==t.status){o=await t.json();if(t.ok)return o;throw new Error(o.message)}this.expiredTokenCallback&&this.expiredTokenCallback()}}}const ErrTokenExpired="token expired";class SessionService{static clearToken(){window.sessionStorage.removeItem("token")}static getToken(){return window.sessionStorage.getItem("token")}static hasToken(){return null!==window.sessionStorage.getItem("token")}static navigateOnTokenExpired(e,t){e.message===ErrTokenExpired&&(SessionService.clearToken(),window.navigateTo(t))}static setToken(e){window.sessionStorage.setItem("token",e)}static tokenExpireFunc(e,t){return e&&401===e.status?(SessionService.clearToken(),SessionService.navigateOnTokenExpired({message:ErrTokenExpired},t),!1):!!SessionService.hasToken()||(SessionService.navigateOnTokenExpired({message:ErrTokenExpired},t),!1)}}const application=(e,t,o=DefaultPageNotFound)=>(window._router=new Router(e,t,o),window.navigateTo=window._router.navigateTo.bind(window._router),window.addEventListener("popstate",e=>{window._router._route({state:e.state})}),{routes:t,targetElement:e,router:window._router,afterRoute:e=>{window._router.afterRoute=e.bind(window._router)},beforeRoute:e=>{window._router.beforeRoute=e.bind(window._router)},injectParams:e=>{window._router.injectParams=e.bind(window._router)},go:()=>{window._router._route({})}});export{BaseView,DefaultPageNotFound,ErrTokenExpired,GraphQL,Router,SessionService,application,fetch$1 as fetch};